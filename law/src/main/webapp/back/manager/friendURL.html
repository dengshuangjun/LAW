<!-- 友情链接 -->
<table id="friendUrl"></table>

<script> 
var editRow=undefined; //记录当期正在编辑的行
var friConnObj;
var picPath;//图片的路径
 
friConnObj = $('#friendUrl').datagrid({
	url : 'friendUrl/findUrl',
	fitColumns : true,//true将自动扩展/收缩columns大小适应grid的宽度,防止水平滚动.
	striped : true,//显示条纹所在行
	loadMsg : "数据加载中...",//当从远程服务器加载数据的时候,显示的提示消息.
	pagination : true,//分页
	fit : true,//满屏
	pageNumber : 1,//初始页码
	pageSize : 10,//分页大小
	pageList : [ 10, 20, 30, 40, 50 ],//设置属性
	sortName : 'conid',//定义那个列可以排序.
	sortOrder : 'asc',
	remoteSort : false,//定义是否远程排序.对数据库进行操作
	columns : [ [ {
		field : 'cconid',
		title : '',
		width : 20,
		align : 'center',
		checkbox : true
	}, {
		field : 'conid',
		title : '链接编号',
		width : 60,
		align : 'center',
		sortable:true
	}, {
		field : 'conName',
		title : '连接名',
		width : 60,
		align : 'center'
	}, {
		field : 'conAddr',
		title : '链接地址',
		width : 240,
		align : 'center'
	}, {
		field : 'conWeight',
		title : '链接权重',
		width : 60,
		align : 'center'
	}, {
		field : 'conStatus',
		title : '链接状态',
		width : 200,
		align : 'center'
	}, {
		field : 'conPic',
		title : '链接图片',
		width : 200,
		align : 'center',
		formatter: function(value,rowData,index){
			if(value!=null && value!="" && value!="NULL"){
				return showPrePic(value);
			}else{
				return;
			}
		}
	} ] ]/* ,
	toolbar:[{
		text:"添加",
		iconCls:"icon-add",
		handler:function(){
			$('#add_group').dialog('open');
		}
	},{
		text:"修改",
		iconCls:"icon-edit",
		handler:function(){
			var rows=friConnObj.datagrid("getChecked");
			var row=friConnObj.datagrid("getChecked")[0];
			if(rows.length>1||rows.length<=0){
				$.messager.alert('友情提示','请选择一行数据进行修改','error');
			}else{
				if(editRow!=undefined){
					if(editRow!=undefined){  //说明有行正在被编辑
						friConnObj.datagrid("rejectChanges"); //回滚所有的数据
						friConnObj.datagrid("endEdit",editRow); //关闭正在被编辑的行
						editRow=undefined;
					}
				}else{
					var option="<option value='"+row.law_group_id+"'>"+row.law_group_id+"</option>";
					$("#group_upid").append($(option));
					$('#group_upleader').val(row.law_group_leader);
					$('#group_uptitle').val(row.law_group_name);
					upUe.setContent(row.law_group_introduce);
					//修改的图片路径
					picPath = row.law_group_srouce_path;
					if( null != picPath && "" != picPath){
						$('#group_pic_show1').html(showPrePic(picPath));
					}
					$('#update_group').dialog('open');
				}
			}
		}
	},{
		text:"删除",
		iconCls:"icon-remove",
		handler:function(){
			//获取选中的行   可以删除多行
			var rows=friConnObj.datagrid("getChecked");
			if(rows.length>=1){
				$.messager.confirm('信息确认','您确定要删除选中的社团吗？',function(rs){  
				    if (rs){  
				        var gids="";
				        for(var i=0;i<rows.length-1;i++){
				        	gids+=rows[i].law_group_id+",";
				        }
				        gids+=rows[i].law_group_id;
				        
				        //发请求到数据库删除
				        $.post("../../GroupServlet",{op:"delGroup",gid:gids},function(data){
				        	if(data>0){
				        		$.messager.show({
									title:'成功提示',
									msg:'社团删除成功！！！',
									timeout:2000,
									showType:'slide'
								});
				        		rows=null;
				        		friConnObj.datagrid("reload");//刷新表格
				        	}else{
				        		$.messager.alert('失败提示','社团删除失败！！！','error');
				        	}
				        });
				    }else{
				    	return;
				    }
				});
				
			}else{
				$.messager.alert('友情提示','请至少选择一行数据进行删除操作','error');
			}
		}
	},{
		text:"撤销",
		iconCls:"icon-redo",
		handler:function(){
			friConnObj.datagrid("rejectChanges");//回滚所有数据
		}
	}] */
});


//设置预览和修改时的图片显示
function showPrePic(value){
	var str="";
	var pics=value.split(",");
	for(var i=0;i<pics.length;i++){
		str+="<img src='../../"+pics[i]+"' width='60px' height='60px'/>&nbsp;";
	}
	return str;
}
</script>