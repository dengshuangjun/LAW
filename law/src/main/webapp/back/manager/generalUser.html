<table id="generalUser_data"></table>  
<script type="text/javascript">
var userObj;
var editRowIng=undefined;
var currentOp;
var flag;
var editRowStatus;
userObj=$('#generalUser_data').datagrid({
	url:'back/generalUserlistByPage',
	fitColumns:true,
	fit:true,
	striped:true,
	loadMsg:"数据加载中...",
	pagination:true,
	pageNumber:1,
	pageSize:10,
	pageList:[2,4,6,8,10],
	remoteSort:false,
	sortName:'register_time',
	columns:[[  
	           {field:'usid',sortable:true,align:'center',checkbox:true}, 
	           {field:'usname',title:'用户名',width:80,align:'center'},  
	           {field:'usex',title:'性别',width:50,align:'center',},  
	           {field:'uemail',title:'邮箱',width:140,align:'center'},
	           {field:'role_name',title:'角色',width:60,align:'center'},
	           {field:'picpath',title:'头像',width:100,align:'center',
		        	formatter: function(value,row,index){
		   				if (value!=null&&value!=""){
		   					var str="";
		   					var pics=value.split(",");
		   					for(var i=0;i<pics.length;i++){
		   						str+="<img src='../../"+pics[i]+"' width='90px' height='90px'/>&nbsp;";
		   					}
		   					return str;
		   					
		   				} else {
		   					return ;
		   				}
		   			}   
	           
	           },
	           {field:'tel',title:'联系方式',width:120,align:'center'},
	           {field:'law_user_status',title:'是否可用',width:60,align:'center',
	        	   formatter: function(value,row,index){
		        		  var valueStr= '<select id="userstate'+row.usid+'" class="easyui-combobox" name="userstate" style="width:40px;"  disabled="none"  onchange="setvalue(this.value)">';
							if(value=='N'){
								valueStr+='<option value="N">否</option><option value="Y">是</option></select>';
							}else{
								valueStr+='<option value="Y">是</option><option value="N">否</option></select>';
							}
							return valueStr;
						}
	           },
	           {field:'law_user_status_explain',title:'备注',width:100,align:'center',editor:{type:"text",options:{requires:true}}},
	           {field:'area',title:'联系地址',width:100,align:'center'},
	           {field:'register_time',title:'注册时间',width:140,align:'center'},
	           {field:'birthday',title:'出生日期',width:140,align:'center'}
	           ]],
      toolbar:[{//datagrid 顶部的工具栏.
      	text:'修改',
      	iconCls:"icon-edit",
      	handler:function(){
      		var rows=userObj.datagrid("getSelections");//获取选中的行
      		if(rows.length>1||rows.length<=0){
				$.messager.alert('提示','您只能一次对一行数据进行修改...','error');
      		}else{
      			$('#userstate'+rows[0].usid).removeAttr('disabled');//下拉能被修改
      			var index= userObj.datagrid("getRowIndex",rows[0]);
      			userObj.datagrid("beginEdit",index);
				editRowIng=index;
      		}
  		}
      },{
        	text:'保存',
          	iconCls:"icon-save",
          	handler:function(){
          		userObj.datagrid("endEdit",editRowIng);
          		var rows=userObj.datagrid("getChanges")[0];//获取选中的行
          		if(rows==undefined){
        			$.messager.alert('失败提示','没有需要保存的行或者您必须修改备注...','error');
        			editRowIng=undefined;
          		}else{
          			rows.law_user_status=editRowStatus;
          			$.post("back/updateGeneralUser",rows,function(data){
          				if(data){
          					$.messager.show({
          						title:'成功提示',
          						msg:'保存信息成功...',
          						timeout:3000,
          						showType:'slide'
          					});
          				}else{
          					$.messager.alert('失败提示','请确认修改的不是管理员...','error');
          				}
          			},"json");
              		$('#userstate'+rows.usid).attr('disabled','none');//下拉不能被修改
              		userObj.datagrid("reload");
              		editRowStatus=undefined;
        			editRowIng=undefined;
          		}          		
      		}
          }
      ]
});
//选择是否的时候设定值
function setvalue(b){
	editRowStatus=b;
}

</script>
